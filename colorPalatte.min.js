(function(f,d,a,g){var e="colorPalatte";var c={getColor:function(h,i){return i.color;},setColor:function(h,i,j){return i._resetSelector(i.ctx,i.ringObj,i.palatteObj,i.sliderObj,j);},};var b=function(i,h){console.error(i);return h||false;};f.fn[e]=function(S,t){var G=this;var N={};if(typeof S==="string"){var j=f.data(this,e);if(!j){return b(e+" was not initialized, can not call method: "+S,g);}if(!f.isFunction(c[S])||S.charAt(0)==="_"){return b("No such method: "+S,g);}return c[S](G,j,t);}else{t=S;var l,J,u,A,p,K,w,h,n,y=false,z=false,Q=false,P,C,x={width:201,height:240,center:{x:100,y:100},radius:{outter:99,inner:85},wearProof:0.5,DefaultColor:"#FF0000",palattePos:{x:50,y:50},palatteSize:{w:100,h:100},sliderPos:{x:60,y:210},sliderSize:{w:140,h:20},previewPos:{x:1,y:210},previewSize:{w:50,h:20},ringSelectorSize:8,palatteSelectorSize:4,sliderSelectorSize:{w:4,h:18},},L=function(Y){var X=Y;if(typeof Y==="string"&&Y.charAt(0)==="#"){Y=Y.replace("#","");if(Y.length!=3&&Y.length!=6){console.error("Error HEX color string: "+X);return null;}if(Y.length==3){var V=Y.split("");Y="";for(var W=0;W<V.length;W++){Y+=V[W]+V[W];}}Y={R:parseInt(Y.slice(0,2),16),G:parseInt(Y.slice(2,4),16),B:parseInt(Y.slice(4,6),16),};}else{if(typeof Y==="string"&&Y.slice(0,3).toLowerCase()==="rgb"){var U=Y.match(/rgba?\( *(\d+) *, *(\d+) *, *(\d+) *(?:, *(1|0\.\d+) *)?\)/i);if(!U){return null;}Y={R:U[1]*1,G:U[2]*1,B:U[3]*1,};if(U[4]!==g){Y.A=U[4]*1;}}}return Y;},T=function(W){if(typeof W==="object"&&W.R!==g){var Y,X,U,V;Y=(W.R).toString(16);Y<16&&(Y="0"+Y);X=W.G.toString(16);X<16&&(X="0"+X);U=W.B.toString(16);U<16&&(U="0"+U);V="#"+Y+X+U;return V;}return W;},v=function(Z){var V;if(typeof Z=="string"&&Z.charAt(0)=="#"){V=L(Z);}else{if(typeof Z==="object"&&Z.R!==g){V=Z;}else{return g;}}var U=V.R,Y=V.G,aa=V.B;var ab=U>Y?(U>aa?U:aa):(Y>aa?Y:aa),W=U<Y?(U<aa?U:aa):(Y<aa?Y:aa),X,ad,ac;if(ab==W){X=0;}else{if(ab==U){X=60*(Y-aa)/(ab-W);if(Y<aa){X+=360;}}else{if(ab==Y){X=60*(aa-U)/(ab-W)+120;}else{if(ab==aa){X=60*(U-Y)/(ab-W)+240;}}}}if(ab==0){ad=0;}else{ad=(ab-W)/ab;}ac=ab;return{H:X,S:ad,V:ac};},O=function(V){var U=H(J[0]);if(!V){V=d.event;}if(V.pageX||V.pageY){return{x:V.pageX-U.left,y:V.pageY-U.top};}return{x:V.clientX+a.documentElement.scrollLeft-a.body.clientLeft-U.left,y:V.clientY+a.documentElement.scrollTop-a.body.clientTop-U.top};},H=function(W){var V=W.offsetTop;var U=W.offsetLeft;W=W.offsetParent;while(W){V+=W.offsetTop;U+=W.offsetLeft;W=W.offsetParent;}return{top:V,left:U};},r=function(V,U){return Math.sqrt((U.x-V.x)*(U.x-V.x)+(U.y-V.y)*(U.y-V.y));},B=function(af,ad,ac,ae,aa,V){for(var X=ae;X>=aa;X-=V){var U=255,Y=0,ab=0,Z=1;for(var W=0;W<Math.PI*2;W+=Math.PI/720){af.strokeStyle="rgb("+U+","+Y+","+ab+")";af.beginPath();af.arc(ad,ac,X,W,W+Math.PI/720,false);af.stroke();switch(Z){case 1:if(Y>=255){Y=255;U=254;Z=2;break;}Y++;break;case 2:if(U<=0){U=0;ab=1;Z=3;break;}U--;break;case 3:if(ab>=255){ab=255;Y=254;Z=4;break;}ab++;break;case 4:if(Y<=0){Y=0;U=1;Z=5;break;}Y--;break;case 5:if(U>=255){U=255;ab=254;Z=6;break;}U++;break;case 6:if(ab<=0){Z=null;break;}ab--;break;default:break;}}}return false;},o=function(af,ad,ac,ae,Y,aa){af.clearRect(ad-1,ac-1,ae+2,Y+2);var U,Z,ab;var X=Y/255;aa=L(aa);if(!aa){return false;}for(var W=0;W<Y;W+=X){var V=af.createLinearGradient(ad,ac,ad+ae,ac);U=Z=ab=Math.floor(255-W*255/Y);V.addColorStop(0,"rgb("+U+","+Z+","+ab+")");U=aa.R-W*255/Y;Z=aa.G-W*255/Y;ab=aa.B-W*255/Y;U=U<0?0:U>255?255:U;Z=Z<0?0:Z>255?255:Z;ab=ab<0?0:ab>255?255:ab;U=Math.floor(U);Z=Math.floor(Z);ab=Math.floor(ab);V.addColorStop(1,"rgb("+U+","+Z+","+ab+")");af.strokeStyle=V;af.beginPath();af.moveTo(ad,ac+W);af.lineTo(ad+ae,ac+W);af.stroke();}return false;},k=function(ad,aa,Z,ab,W,X){X=L(X);if(!X){return false;}ad.clearRect(aa-1,Z-1,ab+2,W+2);ad.fillStyle="rgba(0,0,0,0.3)";var Y=Math.floor(W/2),ac=Math.floor(ab/Y);for(var V=0;V<ac;V+=2){if((aa+V*Y)<(aa+ab)){ad.fillRect(aa+V*Y,Z,Y,Y);}if((aa+(V+1)*Y)<(aa+ab)){ad.fillRect(aa+(V+1)*Y,Z+Y,Y,Y);}}var U=ad.createLinearGradient(aa,Z,ab,Z);U.addColorStop(0,"rgba("+X.R+","+X.G+","+X.B+",0)");U.addColorStop(1,"rgba("+X.R+","+X.G+","+X.B+",1)");ad.fillStyle=U;ad.strokeStyle="#000000";ad.fillRect(aa,Z,ab,W);ad.strokeRect(aa,Z,ab,W);return false;},D=function(X,V,aa,W,Z,U,Y){if(!Y){Y=U;U=g;}if(U){X.clearRect(V,aa,W/2,Z);X.fillStyle="rgba(0,0,0,0.3)";X.fillRect(V,aa,W/4,Z/2);X.fillRect(V+W/4,aa+Z/2,W/4,Z/2);U=L(U);X.fillStyle="rgba("+U.R+","+U.G+","+U.B+","+(U.A?U.A:1)+")";X.fillRect(V,aa,W/2,Z);}if(Y){X.clearRect(V+W/2,aa,W/2,Z);X.fillStyle="rgba(0,0,0,0.3)";X.fillRect(V+W/2,aa,W/4,Z/2);X.fillRect(V+W*3/4,aa+Z/2,W/4,Z/2);Y=L(Y);if(!Y){return false;}X.fillStyle="rgba("+Y.R+","+Y.G+","+Y.B+","+(Y.A!==g?Y.A:1)+")";X.fillRect(V+W/2,aa,W/2,Z);}X.strokeStyle="#000000";X.strokeRect(V,aa,W,Z);return false;},I=function(ag,X){if(!X.ringPos||!X.palattePos||!X.sliderPos){return false;}var aa,ae,ab,af,Y;ae=X.ringPos.x;ab=X.ringPos.y;var ac=ae-x.center.x,ad=ab-x.center.y,W,U,Z,ac;if(ac===0){W=Math.PI/2;}else{W=Math.abs(Math.atan(ad/ac));}if(ad>=0&&ac>0&&W<=Math.PI/3){U=255;Z=W*255*3/Math.PI;ac=0;}else{if(ad>0&&ac>=0&&Math.PI/3<W){U=255*2-W*255*3/Math.PI;Z=255;ac=0;}else{if(ad>0&&ac<0&&Math.PI/3<W){U=W*255*3/Math.PI-255;Z=255;ac=0;}else{if(ad>=0&&ac<0&&W<=Math.PI/3){U=0;Z=255;ac=255-W*255*3/Math.PI;}else{if(ad<0&&ac<0&&W<=Math.PI/3){U=0;Z=255-W*255*3/Math.PI;ac=255;}else{if(ad<0&&ac<0&&Math.PI/3<W){U=W*255*3/Math.PI-255;Z=0;ac=255;}else{if(ad<0&&ac>=0&&Math.PI/3<W){U=255*2-W*255*3/Math.PI;Z=0;ac=255;}else{if(ad<0&&ac>0&&W<=Math.PI/3){U=255;Z=0;ac=W*255*3/Math.PI;}}}}}}}}U=Math.floor(U);Z=Math.floor(Z);ac=Math.floor(ac);aa={R:U,G:Z,B:ac};o(ag,x.palattePos.x,x.palattePos.y,x.palatteSize.w,x.palatteSize.h,aa);ae=X.palattePos.x-x.palattePos.x;ab=X.palattePos.y-x.palattePos.y;af=x.palatteSize.w;Y=x.palatteSize.h;U=aa.R-ab*255/Y;Z=aa.G-ab*255/Y;ac=aa.B-ab*255/Y;U=U<0?0:U>255?255:U;Z=Z<0?0:Z>255?255:Z;ac=ac<0?0:ac>255?255:ac;U=Math.floor(U);Z=Math.floor(Z);ac=Math.floor(ac);var V=Math.floor(255-ab*255/Y);U=V-(V-U)*ae/af;Z=V-(V-Z)*ae/af;ac=V-(V-ac)*ae/af;U=Math.floor(U);Z=Math.floor(Z);ac=Math.floor(ac);aa={R:U,G:Z,B:ac};ae=X.sliderPos.x-x.sliderPos.x;af=x.sliderSize.w-x.sliderSelectorSize.w/2-1;var ad=(ae/af).toFixed(2);ad>=0.99&&(ad=1);ad<=0.01&&(ad=0);if(ad<1){aa.A=ad;}D(ag,x.previewPos.x,x.previewPos.y,x.previewSize.w,x.previewSize.h,aa);k(ag,x.sliderPos.x,x.sliderPos.y,x.sliderSize.w,x.sliderSize.h,aa);return aa;},R=function(ae,V,ac,ad,Z){var U=v(Z),ab,aa,Y=n;var X=(x.radius.inner+x.radius.outter)/2,W=x.ringSelectorSize/2+1;ab=x.center.x+X*Math.cos(U.H*Math.PI/180);aa=x.center.y+X*Math.sin(U.H*Math.PI/180);Y.ringPos={x:ab,y:aa};ab-=W;aa-=W;V.css({left:ab,top:aa});W=x.palatteSelectorSize/2+1;ab=x.palattePos.x+U.S*x.palatteSize.w;aa=x.palattePos.y+(1-U.V/255)*x.palatteSize.h;Y.palattePos={x:ab,y:aa};ab-=W;aa-=W;ac.css({left:ab,top:aa});if(Z.A!==g&&Z.A<0.99){ab=x.sliderPos.x+Z.A*(x.sliderSize.w-x.sliderSelectorSize.w/2-1);Y.sliderPos={x:ab,y:0};ad.css({left:ab});}I(ae,Y);return false;},M=function(V){var U;if(V.A!==g){U="rgba("+V.R+","+V.G+","+V.B+","+V.A+")";}else{U=T(V).toUpperCase();}N.color=U;if(K){K.val(U);}return false;},i=function(U,W,Y){var X=r(Y,x.center);Y={x:(Y.x-x.center.x)*((x.radius.inner+x.radius.outter)/2)/X+x.center.x-x.ringSelectorSize/2-1,y:(Y.y-x.center.y)*((x.radius.inner+x.radius.outter)/2)/X+x.center.y-x.ringSelectorSize/2-1,};W.css({left:Y.x+"px",top:Y.y+"px"});n.ringPos=Y;var V=I(U,n);M(V);return false;},m=function(U,W,X){X={x:X.x<x.palattePos.x?x.palattePos.x:X.x>x.palattePos.x+x.palatteSize.w?x.palattePos.x+x.palatteSize.w:X.x,y:X.y<x.palattePos.y?x.palattePos.y:X.y>x.palattePos.y+x.palatteSize.h?x.palattePos.y+x.palatteSize.h:X.y,};n.palattePos={x:X.x,y:X.y,};var V=I(U,n);M(V);X={x:X.x-x.palatteSelectorSize/2-1,y:X.y-x.palatteSelectorSize/2-1,};W.css({left:X.x+"px",top:X.y+"px"});return false;},F=function(U,W,X){X={x:X.x-x.sliderSelectorSize.w/2-1,y:x.sliderPos.y};X.x=X.x<x.sliderPos.x?x.sliderPos.x:X.x>x.sliderPos.x+x.sliderSize.w-x.sliderSelectorSize.w?x.sliderPos.x+x.sliderSize.w-x.sliderSelectorSize.w-1:X.x-x.sliderSelectorSize.w/2;W.css({left:X.x+"px",top:X.y+"px"});n.sliderPos={x:X.x,y:0,};var V=I(U,n);M(V);return false;},q=function(){f("body").mousemove(function(V){if(y||z||Q){var U=O(V);if(y){i(P,u,U);}else{if(z){m(P,A,U);}else{if(Q){F(P,p,U);}}}}}).mouseup(function(U){y=z=Q=false;E();});},E=function(){f("body").unbind("mousemove").unbind("mouseup");};C=f.extend({},f.fn[e].defaults,t);var s='<div name="colorPalatte" style="display:none;background:#D3D3D3;width:'+x.width+"px;height:"+(x.height+37)+'px;margin-top:5px;border-radius:5px;border:2px #333 solid;position:relative;cursor:crosshair;-webkit-user-select:none;-moz-user-select:none;"><div name="ringSelector" style="border:1px solid #000;background:rgba(255,255,255,0.7);width:'+x.ringSelectorSize+"px;height:"+x.ringSelectorSize+"px;border-radius:"+x.ringSelectorSize+"px;position:absolute;z-index:10;left:"+(x.center.x+(x.radius.outter+x.radius.inner)/2-x.ringSelectorSize/2-1)+"px;top:"+(x.center.y-x.ringSelectorSize/2-1)+'px;"></div><div name="palatteSelector" style="border:1px solid #000;background:rgba(255,255,255,0.7);width:'+x.palatteSelectorSize+"px;height:"+x.palatteSelectorSize+"px;border-radius:"+x.palatteSelectorSize+"px;position:absolute;z-index:10;left:"+(x.palattePos.x+x.palatteSize.w-x.palatteSelectorSize/2-1)+"px;top:"+(x.palattePos.y-x.palatteSelectorSize/2-1)+'px;"></div><div name="sliderSelector" style="border:1px solid #000;background:rgba(255,255,255,0.7);width:'+x.sliderSelectorSize.w+"px;height:"+x.sliderSelectorSize.h+"px;position:absolute;z-index:10;left:"+(x.sliderPos.x+x.sliderSize.w-x.sliderSelectorSize.w-1)+"px;top:"+(x.sliderPos.y)+'px;"></div><canvas width="'+x.width+'px" height="'+x.height+'px" style="position:absolute;z-index:5;left:0;top:0;"></canvas><input name="Result" type="text" style="line-height:1.42857143;padding:6px;color:#555;background:#FFF;border:1px solid #CCC;width:140px;position:absolute;z-index:5;left:0;top:'+x.height+'px;" value="#FF0000"/><button name="confirm" type="button" style="line-height:1.42857143;padding:6px;color:#FFF;background:#337AB7;border:1px solid #CCC;position:absolute;z-index:5;left:160px;top:'+x.height+'px;border-radius:5px;cursor:pointer;">确认</button><div name="close" type="button" style="color:#777;background:transparent;position:absolute;z-index:5;right:2px;top:2px;cursor:pointer;">&times;</div></div>';G.after(s);l=G.next('div[name="colorPalatte"]');J=l.children("canvas");P=J[0].getContext("2d");u=l.children('div[name="ringSelector"]');A=l.children('div[name="palatteSelector"]');p=l.children('div[name="sliderSelector"]');K=l.children('input[name="Result"]');w=l.children('button[name="confirm"]');h=l.children('div[name="close"]');N.color=x.DefaultColor;l[0].onselectstart=function(){return false;};l[0].oncontextmenu=function(){return false;};B(P,x.center.x,x.center.y,x.radius.outter,x.radius.inner,x.wearProof);o(P,x.palattePos.x,x.palattePos.y,x.palatteSize.w,x.palatteSize.h,x.DefaultColor);k(P,x.sliderPos.x,x.sliderPos.y,x.sliderSize.w,x.sliderSize.h,x.DefaultColor);D(P,x.previewPos.x,x.previewPos.y,x.previewSize.w,x.previewSize.h,x.DefaultColor,x.DefaultColor);n={ringPos:{x:(x.center.x+(x.radius.outter+x.radius.inner)/2),y:x.center.y},palattePos:{x:x.palattePos.x+x.palatteSize.w,y:0},sliderPos:{x:x.sliderPos.x+x.sliderSize.w-x.sliderSelectorSize.w,y:0},};R(P,u,A,p,x.DefaultColor);J.mousedown(function(W){var U=O(W);if(0<U.x&&U.x<x.radius.outter*2&&0<U.y&&U.y<x.radius.outter*2){var V=r(U,x.center);if(x.radius.inner<=V&&V<=x.radius.outter){i(P,u,U);y=true;q();}else{if(x.palattePos.x<U.x&&U.x<x.palattePos.x+x.palatteSize.w&&x.palattePos.y<U.y&&U.y<x.palattePos.y+x.palatteSize.h){m(P,A,U);z=true;q();}}}else{if(x.sliderPos.x<U.x&&U.x<x.sliderPos.x+x.sliderSize.w&&x.sliderPos.y<U.y&&U.y<x.sliderPos.y+x.sliderSize.h){F(P,p,U);Q=true;q();}}});u.mousedown(function(V){var U=O(V);i(P,f(this),U);y=true;q();});A.mousedown(function(V){var U=O(V);m(P,f(this),U);z=true;q();});p.mousedown(function(V){var U=O(V);F(P,f(this),U);Q=true;q();});K.on("input propertychange",function(V){var W=f(this).val(),U;if(W.charAt(0)=="#"&&(W.length==4||W.length==7)){U=W;}else{if(W.slice(0,3).toLowerCase()=="rgb"&&W.charAt(W.length-1)==")"){U=L(W);if(!U){return false;}}else{return false;}}R(P,u,A,p,U);});G.click(function(U){D(P,x.previewPos.x,x.previewPos.y,x.previewSize.w,x.previewSize.h,N.color,N.color);if(C.showMethod=="slide"){l.slideDown(C.delay);}else{if(C.showMethod=="fade"){l.fadeIn(C.delay);}}});w.click(function(U){var V=K.val();var W;if(V&&V.charAt(0)=="#"&&(V.length==4||V.length==7)){}else{if(V&&V.test(/rgba?\( *(\d+) *, *(\d+) *, *(\d+) *(?:, *(1|0\.\d+) *)?\)/i)){}else{return false;}}N.color=V;if(!C.targetObj){W=G;}else{if(C.targetObj.length){W=C.targetObj;}else{return false;}}if(V&&C.resultFormat=="string"){if(("|input|textarea|").indexOf(G[0].tagName.toLowerCase())>0){W.val(V);}else{if(("|div|p|a|i|u|b|s|span|button|li|td|dl|dt|header|footer|nav|article|aside|").indexOf(G[0].tagName.toLowerCase())>0){W.html(V);}}}else{if(V&&(C.resultFormat=="background"||C.resultFormat=="color")){W.css(C.resultFormat,V);}}if(C.confirm){C.confirm();}l.fadeOut(C.delay);});h.click(function(U){if(C.showMethod=="slide"){l.slideUp(C.delay);}else{if(C.showMethod=="fade"){l.fadeOut(C.delay);}}});N.ctx=P;N.ringObj=u;N.palatteObj=A;N.sliderObj=p;N._resetSelector=R;f.data(this,e,N);return G;}};f.fn[e].defaults={targetObj:"",delay:300,resultFormat:"string",closeBtn:true,showMethod:"slide",confirm:null,};}(window.jQuery));